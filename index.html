<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RichAirDrop - Earn SHIB Daily</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <!-- Ad SDK -->
    <script src='//libtl.com/sdk.js' data-zone='10005454' data-sdk='show_10005454'></script>
    <style>
        :root {
            --primary-bg: #1a1a2e;
            --card-bg: #16213e;
            --accent: #0f3460;
            --highlight: #e94560;
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --border: #2a2a4a;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 80px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(233, 69, 96, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(15, 52, 96, 0.1) 0%, transparent 20%);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--accent), var(--highlight));
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            animation: fadeInDown 0.8s ease;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 5px;
            position: relative;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.5px;
        }

        .tagline {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            font-weight: 300;
            letter-spacing: 0.3px;
        }

        /* User Profile */
        .user-profile {
            display: flex;
            align-items: center;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-profile:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--highlight));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin-right: 15px;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
            animation: pulse 2s infinite;
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 4px;
            letter-spacing: 0.2px;
        }

        .user-id {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .balance {
            text-align: right;
        }

        .shib-amount {
            font-size: 20px;
            font-weight: 700;
            color: var(--highlight);
            text-shadow: 0 2px 10px rgba(233, 69, 96, 0.3);
            letter-spacing: 0.3px;
        }

        /* Stats Cards - New Layout */
        .stats-container {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            animation: fadeInUp 0.8s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            flex: 1;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--highlight);
            letter-spacing: 0.3px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        /* New Activity Section - Like Second Image */
        .activity-section {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease 0.4s both;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .activity-header {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            color: var(--highlight);
            letter-spacing: 0.3px;
            text-shadow: 0 2px 10px rgba(233, 69, 96, 0.2);
        }

        .activity-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            gap: 15px;
        }

        .activity-stat {
            flex: 1;
            text-align: center;
        }

        .activity-stat-number {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--highlight);
            letter-spacing: 0.3px;
        }

        .activity-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .watch-ad-button {
            background: linear-gradient(135deg, var(--highlight), #ff7b93);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px;
            width: 100%;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
        }

        .watch-ad-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(233, 69, 96, 0.6);
        }

        .watch-ad-button:active {
            transform: translateY(1px);
        }

        .watch-ad-button:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .watch-ad-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
        }

        .watch-ad-button:not(:disabled):hover::after {
            animation: shine 1.5s;
        }

        /* Task Cards */
        .section-title {
            font-size: 22px;
            margin: 25px 0 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
            animation: fadeIn 0.8s ease;
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        .task-card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            animation: fadeInUp 0.8s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .task-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--highlight));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(15, 52, 96, 0.3);
        }

        .task-title {
            font-weight: 600;
            flex: 1;
            font-size: 17px;
            letter-spacing: 0.2px;
        }

        .task-progress {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .progress-dots {
            display: flex;
            margin-right: 15px;
        }

        .progress-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: var(--primary-bg);
            margin-right: 8px;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .progress-dot.completed {
            background-color: var(--success);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .progress-text {
            font-size: 15px;
            color: var(--text-secondary);
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .claim-button {
            background: linear-gradient(135deg, var(--highlight), #ff7b93);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
            letter-spacing: 0.3px;
        }

        .claim-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(233, 69, 96, 0.5);
        }

        .claim-button:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Withdraw Section */
        .withdraw-container {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .withdraw-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .withdraw-title {
            font-size: 22px;
            margin-bottom: 20px;
            text-align: center;
            color: var(--highlight);
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        .min-withdraw {
            text-align: center;
            margin-bottom: 25px;
            font-size: 15px;
            color: var(--text-secondary);
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 10px;
            font-size: 15px;
            color: var(--text-secondary);
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background-color: var(--primary-bg);
            color: var(--text);
            font-size: 16px;
            transition: var(--transition);
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--highlight);
            box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.2);
        }

        .withdraw-button {
            background: linear-gradient(135deg, var(--highlight), #ff7b93);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 18px;
            width: 100%;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 25px;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
            letter-spacing: 0.5px;
        }

        .withdraw-button i {
            margin-right: 12px;
        }

        .withdraw-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(233, 69, 96, 0.6);
        }

        .withdraw-history {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .withdraw-history:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .history-title {
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        .no-history {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            font-style: italic;
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        /* Referral Section */
        .referral-container {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .referral-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .referral-message {
            text-align: center;
            margin-bottom: 25px;
            color: var(--text-secondary);
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .referral-link-container {
            background-color: var(--primary-bg);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .referral-link {
            flex: 1;
            font-family: monospace;
            font-size: 15px;
            word-break: break-all;
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .copy-button {
            background: linear-gradient(135deg, var(--accent), var(--highlight));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            margin-left: 12px;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(15, 52, 96, 0.3);
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        .copy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(15, 52, 96, 0.4);
        }

        .leaderboard {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .leaderboard:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .leaderboard-title {
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        .leaderboard-item:hover {
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding-left: 10px;
            padding-right: 10px;
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .rank {
            width: 35px;
            text-align: center;
            font-weight: 700;
            margin-right: 12px;
            font-size: 18px;
            letter-spacing: 0.2px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--highlight));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(15, 52, 96, 0.3);
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 16px;
            letter-spacing: 0.2px;
        }

        .user-id {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .referral-stats {
            text-align: right;
        }

        .referral-count {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 16px;
            letter-spacing: 0.2px;
        }

        .referral-reward {
            font-size: 13px;
            color: var(--highlight);
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        /* Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 18px 0;
            border-top: 1px solid var(--border);
            z-index: 100;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 12px;
            transition: var(--transition);
            position: relative;
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        .nav-item.active {
            color: var(--highlight);
        }

        .nav-item.active .nav-icon {
            transform: translateY(-5px);
        }

        .nav-icon {
            font-size: 22px;
            margin-bottom: 5px;
            transition: var(--transition);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -18px;
            width: 6px;
            height: 6px;
            background-color: var(--highlight);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--highlight);
        }

        /* Section Management */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            animation: fadeInDown 0.8s ease;
        }

        .admin-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border);
            animation: fadeIn 0.8s ease;
        }

        .admin-tab {
            padding: 12px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        .admin-tab.active {
            border-bottom: 3px solid var(--highlight);
            color: var(--highlight);
        }

        .admin-tab:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .admin-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .admin-section.active {
            display: block;
        }

        .admin-card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .admin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th, .admin-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        .admin-table th {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .admin-button {
            background: linear-gradient(135deg, var(--highlight), #ff7b93);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 18px;
            cursor: pointer;
            margin-right: 8px;
            font-size: 14px;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        .admin-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(233, 69, 96, 0.5);
        }

        .admin-button.approve {
            background: linear-gradient(135deg, var(--success), #6fcf97);
        }

        .admin-button.reject {
            background: linear-gradient(135deg, var(--danger), #ff7676);
        }

        .admin-form {
            display: grid;
            gap: 20px;
        }

        .admin-input-group {
            display: flex;
            flex-direction: column;
        }

        .admin-label {
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
            letter-spacing: 0.2px;
        }

        .admin-input {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background-color: var(--primary-bg);
            color: var(--text);
            transition: var(--transition);
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--highlight);
            box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.2);
        }

        /* Ad Loading Indicator */
        .ad-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .ad-loading.active {
            display: flex;
        }

        .ad-loading-text {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--highlight);
            text-align: center;
        }

        /* Login Panel */
        .login-panel {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            margin: 50px auto;
            box-shadow: var(--shadow);
            text-align: center;
            animation: fadeIn 0.8s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .login-title {
            font-size: 28px;
            margin-bottom: 25px;
            color: var(--highlight);
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background-color: var(--primary-bg);
            color: var(--text);
            transition: var(--transition);
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--highlight);
            box-shadow: 0 0 0 2px rgba(233, 69, 96, 0.2);
        }

        .login-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--highlight), #ff7b93);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 15px;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
            letter-spacing: 0.5px;
        }

        .login-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(233, 69, 96, 0.6);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from { 
                opacity: 0;
                transform: scale(0.9);
            }
            to { 
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--highlight);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .admin-table {
                font-size: 14px;
            }
            
            .admin-table th, .admin-table td {
                padding: 10px 5px;
            }
            
            .header {
                padding: 20px;
            }
            
            .logo {
                font-size: 24px;
            }
            
            .activity-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .activity-stat-number {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Login Panel -->
    <div id="login-panel" class="login-panel">
        <div class="login-title">Admin Login</div>
        <input type="text" id="admin-username" class="login-input" placeholder="Username">
        <input type="password" id="admin-password" class="login-input" placeholder="Password">
        <button id="admin-login-button" class="login-button">Login</button>
    </div>

    <!-- User Panel -->
    <div id="user-panel" class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">RichAirDrop</div>
            <div class="tagline">Earn SHIB Daily</div>
        </div>

        <!-- User Profile -->
        <div class="user-profile">
            <div class="avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-info">
                <div class="username" id="user-display-name">Loading...</div>
                <div class="user-id" id="user-display-id">ID: Loading...</div>
            </div>
            <div class="balance">
                <div class="shib-amount" id="user-balance">0 SHIB</div>
            </div>
        </div>

        <!-- Task Section -->
        <div id="task-section" class="section active">
            <!-- Stats Cards -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="total-watched">0</div>
                    <div class="stat-label">Total Watched</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="left-today">5</div>
                    <div class="stat-label">Left Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="reward-per-ad">20.00</div>
                    <div class="stat-label">Reward/Ad</div>
                </div>
            </div>

            <!-- New Activity Section - Like Second Image -->
            <div class="activity-section">
                <div class="activity-header">Watch Ads & Earn</div>
                <div class="activity-stats">
                    <div class="activity-stat">
                        <div class="activity-stat-number" id="activity-total-watched">0</div>
                        <div class="activity-stat-label">Total Watched</div>
                    </div>
                    <div class="activity-stat">
                        <div class="activity-stat-number" id="activity-left-this-hour">5</div>
                        <div class="activity-stat-label">Left Today</div>
                    </div>
                    <div class="activity-stat">
                        <div class="activity-stat-number" id="activity-reward-per-ad">20.00</div>
                        <div class="activity-stat-label">Reward/Ad</div>
                    </div>
                </div>
                <button id="watch-ad-button" class="watch-ad-button">Watch Ad Now</button>
            </div>

            <!-- Available Tasks -->
            <div class="section-title">Available Tasks</div>
            
            <div id="tasks-container">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Withdraw Section -->
        <div id="withdraw-section" class="section">
            <div class="withdraw-container">
                <div class="withdraw-title">Withdraw SHIB</div>
                <div class="min-withdraw">
                    Minimum withdrawal: <strong id="min-withdrawal-amount">3,000 SHIB</strong> â€¢ BEP20<br>
                    (Binance Smart Chain)
                </div>
                
                <div class="input-group">
                    <label class="input-label">Amount (SHIB)</label>
                    <input type="number" id="withdraw-amount" class="input-field" placeholder="Enter SHIB amount">
                </div>
                
                <div class="input-group">
                    <label class="input-label">SHIB BEP20 Address</label>
                    <input type="text" id="withdraw-address" class="input-field" placeholder="0x... (BEP20)">
                </div>
                
                <button id="withdraw-button" class="withdraw-button">
                    <i class="fas fa-sync-alt"></i> Withdraw SHIB
                </button>
            </div>

            <div class="withdraw-history">
                <div class="history-title">Withdrawal History</div>
                <div id="withdrawal-history-container">
                    <div class="no-history">No withdrawal history yet.</div>
                </div>
            </div>
        </div>

        <!-- Invite Section -->
        <div id="invite-section" class="section">
            <div class="referral-container">
                <div class="referral-message" id="referral-message">
                    No referrals yet. Share your link to start earning!
                </div>
                
                <div class="referral-link-container">
                    <div class="referral-link" id="referral-link">Loading...</div>
                    <button class="copy-button">Copy</button>
                </div>
            </div>

            <div class="leaderboard">
                <div class="leaderboard-title">Leaderboard</div>
                <div id="leaderboard-container">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <!-- Cards Section (Placeholder) -->
        <div id="cards-section" class="section">
            <div class="section-title">Cards</div>
            <div class="task-card">
                <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                    <i class="fas fa-id-card" style="font-size: 48px; margin-bottom: 15px;"></i>
                    <div>Cards feature coming soon</div>
                </div>
            </div>
        </div>

        <!-- My Task Section (Placeholder) -->
        <div id="mytask-section" class="section">
            <div class="section-title">My Task</div>
            <div class="task-card">
                <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                    <i class="fas fa-tasks" style="font-size: 48px; margin-bottom: 15px;"></i>
                    <div>Personal task management coming soon</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="admin-panel container">
        <div class="admin-header">
            <div class="logo">RichAirDrop Admin</div>
            <button id="admin-logout" class="admin-button">Logout</button>
        </div>

        <div class="admin-tabs">
            <div class="admin-tab active" data-tab="dashboard">Dashboard</div>
            <div class="admin-tab" data-tab="tasks">Tasks</div>
            <div class="admin-tab" data-tab="withdrawals">Withdrawals</div>
            <div class="admin-tab" data-tab="settings">Settings</div>
            <div class="admin-tab" data-tab="ads">Ads Restock</div>
        </div>

        <!-- Dashboard Section -->
        <div id="admin-dashboard" class="admin-section active">
            <div class="admin-card">
                <h3>System Overview</h3>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-number" id="total-users">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="daily-ad-limit">5</div>
                        <div class="stat-label">Daily Ad Limit</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pending-withdrawals">0</div>
                        <div class="stat-label">Pending Withdrawals</div>
                    </div>
                </div>
            </div>

            <div class="admin-card">
                <h3>Quick Actions</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button id="restock-ads-btn" class="admin-button">Restock All Ads</button>
                    <button id="add-task-btn" class="admin-button">Add Task</button>
                    <button id="view-users-btn" class="admin-button">View Users</button>
                </div>
            </div>
        </div>

        <!-- Tasks Section -->
        <div id="admin-tasks" class="admin-section">
            <div class="admin-card">
                <h3>Manage Tasks</h3>
                <div id="admin-tasks-container">
                    <div class="no-history">No tasks created yet.</div>
                </div>
            </div>

            <div class="admin-card">
                <h3>Add New Task</h3>
                <form id="add-task-form" class="admin-form">
                    <div class="admin-input-group">
                        <label class="admin-label">Task Title</label>
                        <input type="text" id="task-title" class="admin-input" required>
                    </div>
                    <div class="admin-input-group">
                        <label class="admin-label">Task Description</label>
                        <input type="text" id="task-description" class="admin-input" required>
                    </div>
                    <div class="admin-input-group">
                        <label class="admin-label">Reward (SHIB)</label>
                        <input type="number" id="task-reward" class="admin-input" required>
                    </div>
                    <div class="admin-input-group">
                        <label class="admin-label">Task Type</label>
                        <select id="task-type" class="admin-input">
                            <option value="join">Join</option>
                            <option value="follow">Follow</option>
                            <option value="invite">Invite</option>
                            <option value="visit">Visit</option>
                        </select>
                    </div>
                    <div class="admin-input-group">
                        <label class="admin-label">Total Required</label>
                        <input type="number" id="task-total" class="admin-input" value="3" required>
                    </div>
                    <button type="submit" class="admin-button">Add Task</button>
                </form>
            </div>
        </div>

        <!-- Withdrawals Section -->
        <div id="admin-withdrawals" class="admin-section">
            <div class="admin-card">
                <h3>Pending Withdrawals</h3>
                <div id="pending-withdrawals-container">
                    <div class="no-history">No pending withdrawals.</div>
                </div>
            </div>

            <div class="admin-card">
                <h3>Withdrawal History</h3>
                <div id="admin-withdrawal-history-container">
                    <div class="no-history">No withdrawal history.</div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="admin-settings" class="admin-section">
            <div class="admin-card">
                <h3>System Settings</h3>
                <form id="system-settings-form" class="admin-form">
                    <div class="admin-input-group">
                        <label class="admin-label">Reward per Ad (SHIB)</label>
                        <input type="number" id="reward-per-ad" class="admin-input" required>
                    </div>
                    <div class="admin-input-group">
                        <label class="admin-label">Daily Ad Limit</label>
                        <input type="number" id="daily-ad-limit" class="admin-input" required>
                    </div>
                    <div class="admin-input-group">
                        <label class="admin-label">Minimum Withdrawal (SHIB)</label>
                        <input type="number" id="min-withdrawal" class="admin-input" required>
                    </div>
                    <div class="admin-input-group">
                        <label class="admin-label">Referral Reward (SHIB)</label>
                        <input type="number" id="referral-reward" class="admin-input" required>
                    </div>
                    <button type="submit" class="admin-button">Save Settings</button>
                </form>
            </div>
        </div>

        <!-- Ads Restock Section -->
        <div id="admin-ads" class="admin-section">
            <div class="admin-card">
                <h3>Ads Restock Management</h3>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    Reset ads for all users. This will allow all users to watch ads again today.
                </p>
                <button id="restock-all-ads-btn" class="admin-button" style="background: linear-gradient(135deg, var(--success), #6fcf97);">
                    <i class="fas fa-sync-alt"></i> Restock Ads for All Users
                </button>
            </div>

            <div class="admin-card">
                <h3>Ads Statistics</h3>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-number" id="total-ads-watched">0</div>
                        <div class="stat-label">Total Ads Watched</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="users-with-ads-left">0</div>
                        <div class="stat-label">Users with Ads Left</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-ad-rewards">0</div>
                        <div class="stat-label">Total SHIB Rewarded</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ad Loading Indicator -->
    <div id="ad-loading" class="ad-loading">
        <div class="spinner"></div>
        <div class="ad-loading-text">Loading Ad...</div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <a href="#" class="nav-item active" data-section="task-section">
            <i class="fas fa-tasks nav-icon"></i>
            <span>TASK</span>
        </a>
        <a href="#" class="nav-item" data-section="cards-section">
            <i class="fas fa-id-card nav-icon"></i>
            <span>CARDS</span>
        </a>
        <a href="#" class="nav-item" data-section="invite-section">
            <i class="fas fa-user-plus nav-icon"></i>
            <span>INVITE</span>
        </a>
        <a href="#" class="nav-item" data-section="withdraw-section">
            <i class="fas fa-wallet nav-icon"></i>
            <span>WITHDRAW</span>
        </a>
        <a href="#" class="nav-item" data-section="mytask-section">
            <i class="fas fa-user nav-icon"></i>
            <span>MY TASK</span>
        </a>
    </div>

    <script>
        // Firebase Configuration - Replace with your actual Firebase config
        const firebaseConfig = {
  apiKey: "AIzaSyDOMdnCV2hXOveocXtEnnwICzJjp0Bb4Mg",
  authDomain: "superairdrop-90c6d.firebaseapp.com",
  projectId: "superairdrop-90c6d",
  storageBucket: "superairdrop-90c6d.firebasestorage.app",
  messagingSenderId: "623122845001",
  appId: "1:623122845001:web:5b0758778b7424dbf75e98"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Global variables
        let currentUser = null;
        let userData = null;
        let systemSettings = {
            rewardPerAd: 20,
            dailyAdLimit: 5,
            minWithdrawal: 3000,
            referralReward: 200,
            tasks: []
        };

        // DOM Elements
        const loginPanel = document.getElementById('login-panel');
        const userPanel = document.getElementById('user-panel');
        const adminPanel = document.getElementById('admin-panel');
        const adminLoginBtn = document.getElementById('admin-login-button');
        const adminLogoutBtn = document.getElementById('admin-logout');
        const watchAdButton = document.getElementById('watch-ad-button');
        const adLoading = document.getElementById('ad-loading');
        const withdrawButton = document.getElementById('withdraw-button');
        const tasksContainer = document.getElementById('tasks-container');
        const adminTasksContainer = document.getElementById('admin-tasks-container');
        const pendingWithdrawalsContainer = document.getElementById('pending-withdrawals-container');
        const adminWithdrawalHistoryContainer = document.getElementById('admin-withdrawal-history-container');
        const withdrawalHistoryContainer = document.getElementById('withdrawal-history-container');
        const leaderboardContainer = document.getElementById('leaderboard-container');
        const addTaskForm = document.getElementById('add-task-form');
        const systemSettingsForm = document.getElementById('system-settings-form');
        const restockAllAdsBtn = document.getElementById('restock-all-ads-btn');

        // Real-time listeners
        let systemSettingsListener = null;
        let userDataListener = null;
        let tasksListener = null;

        // Platform Detection
        function isTelegramWebApp() {
            return window.Telegram && window.Telegram.WebApp;
        }

        // Initialize based on platform
        function initializeApp() {
            if (isTelegramWebApp()) {
                // Telegram Web App - Show User Panel
                initializeTelegramUser();
            } else {
                // Browser - Check if admin
                checkAdminStatus();
            }
        }

        // Check if user is admin
        function checkAdminStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            const isAdmin = urlParams.get('admin') === 'true';
            
            if (isAdmin) {
                loginPanel.style.display = 'block';
                userPanel.style.display = 'none';
                adminPanel.style.display = 'none';
            } else {
                // Show user panel in browser if not admin
                loginPanel.style.display = 'none';
                userPanel.style.display = 'block';
                adminPanel.style.display = 'none';
                initializeUserPanel();
            }
        }

        // Initialize Telegram User
        async function initializeTelegramUser() {
            const tg = window.Telegram.WebApp;
            tg.expand();
            
            // Get user data from Telegram
            const user = tg.initDataUnsafe.user;
            
            if (user) {
                currentUser = {
                    uid: user.id.toString(),
                    displayName: `${user.first_name} ${user.last_name || ''}`.trim(),
                    username: user.username || `user${user.id}`
                };
                
                document.getElementById('user-display-name').textContent = currentUser.displayName;
                document.getElementById('user-display-id').textContent = `ID: ${currentUser.uid}`;
                
                // Load user data from Firebase
                await loadUserData(currentUser.uid);
                setupRealTimeListeners(currentUser.uid);
            } else {
                // Fallback for testing
                currentUser = {
                    uid: 'tg_user_' + Math.floor(Math.random() * 1000000),
                    displayName: 'Telegram User',
                    username: 'tguser'
                };
                document.getElementById('user-display-name').textContent = currentUser.displayName;
                document.getElementById('user-display-id').textContent = `ID: ${currentUser.uid}`;
                await loadUserData(currentUser.uid);
                setupRealTimeListeners(currentUser.uid);
            }
            
            loginPanel.style.display = 'none';
            userPanel.style.display = 'block';
            adminPanel.style.display = 'none';
        }

        // Set up real-time listeners
        function setupRealTimeListeners(userId) {
            // System settings listener
            systemSettingsListener = db.collection('systemSettings').doc('settings')
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        systemSettings = doc.data();
                        updateSystemSettingsUI();
                        loadTasks();
                    }
                }, (error) => {
                    console.error("Error listening to system settings:", error);
                });

            // User data listener
            userDataListener = db.collection('users').doc(userId)
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        userData = doc.data();
                        updateUserUI();
                    }
                }, (error) => {
                    console.error("Error listening to user data:", error);
                });
        }

        // Load User Data from Firebase
        async function loadUserData(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                
                if (userDoc.exists) {
                    userData = userDoc.data();
                    
                    // Check if we need to reset daily ads
                    const today = new Date().toDateString();
                    if (userData.lastAdReset !== today) {
                        userData.adsToday = 0;
                        userData.lastAdReset = today;
                        await db.collection('users').doc(userId).update({
                            adsToday: 0,
                            lastAdReset: today
                        });
                    }
                } else {
                    // Initialize new user with 0 balance
                    userData = {
                        uid: userId,
                        balance: 0,
                        totalEarned: 0,
                        adsWatched: 0,
                        adsToday: 0,
                        referralCount: 0,
                        referralCode: `ref${userId}`,
                        tasksCompleted: {},
                        referredBy: null,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastAdReset: new Date().toDateString()
                    };
                    
                    // Check for referral code in URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const refCode = urlParams.get('ref');
                    if (refCode) {
                        // Find user with this referral code and reward them
                        await rewardReferrer(refCode);
                        userData.referredBy = refCode;
                    }
                    
                    // Save new user to Firebase
                    await db.collection('users').doc(userId).set(userData);
                }
                
                updateUserUI();
                await loadTasks();
                await loadWithdrawalHistory();
                await loadLeaderboard();
            } catch (error) {
                console.error("Error loading user data:", error);
                // Fallback to localStorage if Firebase fails
                const storedUserData = localStorage.getItem(`user_${userId}`);
                if (storedUserData) {
                    userData = JSON.parse(storedUserData);
                    updateUserUI();
                    loadTasks();
                    loadWithdrawalHistory();
                    loadLeaderboard();
                } else {
                    // Initialize new user with 0 balance
                    userData = {
                        uid: userId,
                        balance: 0,
                        totalEarned: 0,
                        adsWatched: 0,
                        adsToday: 0,
                        referralCount: 0,
                        referralCode: `ref${userId}`,
                        tasksCompleted: {},
                        referredBy: null,
                        lastAdReset: new Date().toDateString()
                    };
                    localStorage.setItem(`user_${userId}`, JSON.stringify(userData));
                    updateUserUI();
                    loadTasks();
                    loadWithdrawalHistory();
                    loadLeaderboard();
                }
            }
        }

        // Reward referrer with SHIB
        async function rewardReferrer(referralCode) {
            try {
                // Find user with this referral code in Firebase
                const usersSnapshot = await db.collection('users').where('referralCode', '==', referralCode).get();
                
                if (!usersSnapshot.empty) {
                    const referrerDoc = usersSnapshot.docs[0];
                    const referrerData = referrerDoc.data();
                    
                    // Reward the referrer
                    referrerData.balance += systemSettings.referralReward;
                    referrerData.referralCount += 1;
                    
                    // Update in Firebase
                    await db.collection('users').doc(referrerDoc.id).update({
                        balance: referrerData.balance,
                        referralCount: referrerData.referralCount
                    });
                    
                    // Update leaderboard
                    loadLeaderboard();
                }
            } catch (error) {
                console.error("Error rewarding referrer:", error);
                // Fallback to localStorage
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('user_')) {
                        const user = JSON.parse(localStorage.getItem(key));
                        if (user.referralCode === referralCode) {
                            // Reward the referrer
                            user.balance += systemSettings.referralReward;
                            user.referralCount += 1;
                            localStorage.setItem(key, JSON.stringify(user));
                            
                            // Update leaderboard
                            loadLeaderboard();
                            break;
                        }
                    }
                }
            }
        }

        // Update User UI with real data
        function updateUserUI() {
            document.getElementById('user-balance').textContent = userData.balance.toLocaleString() + ' SHIB';
            
            document.getElementById('total-watched').textContent = userData.adsWatched;
            document.getElementById('activity-total-watched').textContent = userData.adsWatched;
            
            const adsLeft = Math.max(0, systemSettings.dailyAdLimit - userData.adsToday);
            document.getElementById('left-today').textContent = adsLeft;
            document.getElementById('activity-left-this-hour').textContent = adsLeft;
            
            document.getElementById('reward-per-ad').textContent = systemSettings.rewardPerAd.toFixed(2);
            document.getElementById('activity-reward-per-ad').textContent = systemSettings.rewardPerAd.toFixed(2);
            
            // Update referral link
            document.getElementById('referral-link').textContent = `https://t.me/RichAirDropBot?start=ref${userData.uid}`;
            
            if (userData.referralCount > 0) {
                document.getElementById('referral-message').textContent = `You have ${userData.referralCount} referrals! Keep sharing to earn more.`;
            }
            
            // Update status message
            if (userData.adsToday >= systemSettings.dailyAdLimit) {
                watchAdButton.disabled = true;
                watchAdButton.textContent = "Daily Limit Reached";
            } else {
                watchAdButton.disabled = false;
                watchAdButton.textContent = "Watch Ad Now";
            }
        }

        // Admin Login
        adminLoginBtn.addEventListener('click', () => {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            // Simple authentication (in production, use Firebase Auth)
            if (username === 'admin' && password === 'admin123') {
                loginPanel.style.display = 'none';
                userPanel.style.display = 'none';
                adminPanel.style.display = 'block';
                initializeAdminPanel();
            } else {
                alert('Invalid credentials');
            }
        });

        // Admin Logout
        adminLogoutBtn.addEventListener('click', () => {
            loginPanel.style.display = 'block';
            userPanel.style.display = 'none';
            adminPanel.style.display = 'none';
            
            // Clean up real-time listeners
            if (systemSettingsListener) {
                systemSettingsListener();
            }
            if (userDataListener) {
                userDataListener();
            }
        });

        // Initialize User Panel
        function initializeUserPanel() {
            // For browser users without Telegram
            currentUser = {
                uid: 'browser_user_' + Math.floor(Math.random() * 1000000),
                displayName: 'Browser User',
                username: 'browseruser'
            };
            
            document.getElementById('user-display-name').textContent = currentUser.displayName;
            document.getElementById('user-display-id').textContent = `ID: ${currentUser.uid}`;
            
            loadUserData(currentUser.uid);
            setupRealTimeListeners(currentUser.uid);
        }

        // Initialize Admin Panel
        async function initializeAdminPanel() {
            await loadSystemSettings();
            await loadAdminTasks();
            await loadPendingWithdrawals();
            await loadAdminWithdrawalHistory();
            await loadAdminStats();
            
            // Set up real-time listener for system settings in admin panel
            db.collection('systemSettings').doc('settings')
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        systemSettings = doc.data();
                        updateSystemSettingsUI();
                        loadAdminTasks();
                    }
                });
            
            // Admin tabs
            const adminTabs = document.querySelectorAll('.admin-tab');
            adminTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and sections
                    adminTabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding section
                    tab.classList.add('active');
                    document.getElementById(`admin-${tabName}`).classList.add('active');
                });
            });
        }

        // Load System Settings
        async function loadSystemSettings() {
            try {
                const settingsDoc = await db.collection('systemSettings').doc('settings').get();
                
                if (settingsDoc.exists) {
                    systemSettings = settingsDoc.data();
                } else {
                    // Create default settings in Firebase
                    await db.collection('systemSettings').doc('settings').set(systemSettings);
                }
            } catch (error) {
                console.error("Error loading system settings:", error);
                // Fallback to localStorage
                const storedSettings = localStorage.getItem('systemSettings');
                if (storedSettings) {
                    systemSettings = JSON.parse(storedSettings);
                }
            }
            
            updateSystemSettingsUI();
        }

        // Update System Settings UI
        function updateSystemSettingsUI() {
            if (document.getElementById('reward-per-ad')) {
                document.getElementById('reward-per-ad').value = systemSettings.rewardPerAd;
                document.getElementById('daily-ad-limit').value = systemSettings.dailyAdLimit;
                document.getElementById('min-withdrawal').value = systemSettings.minWithdrawal;
                document.getElementById('referral-reward').value = systemSettings.referralReward;
            }
            
            if (document.getElementById('daily-ad-limit')) {
                document.getElementById('daily-ad-limit').textContent = systemSettings.dailyAdLimit;
            }
            
            // Update user panel if it exists
            if (document.getElementById('reward-per-ad')) {
                document.getElementById('reward-per-ad').textContent = systemSettings.rewardPerAd.toFixed(2);
                document.getElementById('activity-reward-per-ad').textContent = systemSettings.rewardPerAd.toFixed(2);
                document.getElementById('min-withdrawal-amount').textContent = `${systemSettings.minWithdrawal.toLocaleString()} SHIB`;
            }
        }

        // Load Tasks from system settings
        function loadTasks() {
            tasksContainer.innerHTML = '';
            
            if (!systemSettings.tasks || systemSettings.tasks.length === 0) {
                tasksContainer.innerHTML = '<div class="no-history">No tasks available. Check back later!</div>';
                return;
            }
            
            systemSettings.tasks.forEach(task => {
                const userCompleted = userData.tasksCompleted && userData.tasksCompleted[task.id] ? userData.tasksCompleted[task.id] : 0;
                const isClaimed = userCompleted >= task.total;
                
                const taskElement = document.createElement('div');
                taskElement.className = 'task-card';
                taskElement.innerHTML = `
                    <div class="task-header">
                        <div class="task-icon">
                            <i class="fab fa-${task.type === 'join' ? 'telegram' : task.type === 'follow' ? 'telegram' : task.type === 'invite' ? 'user-plus' : 'globe'}"></i>
                        </div>
                        <div class="task-title">${task.title}</div>
                    </div>
                    <div class="task-progress">
                        <div class="progress-dots">
                            ${Array.from({length: task.total}, (_, i) => 
                                `<div class="progress-dot ${i < userCompleted ? 'completed' : ''}"></div>`
                            ).join('')}
                        </div>
                        <div class="progress-text">${userCompleted}/${task.total}</div>
                    </div>
                    <button class="claim-button" ${isClaimed ? 'disabled' : ''}>${isClaimed ? 'Claimed' : 'Claim'}</button>
                `;
                
                // Add event listener for claim button
                const claimBtn = taskElement.querySelector('.claim-button');
                if (!isClaimed) {
                    claimBtn.addEventListener('click', () => {
                        claimTaskReward(task.id, task.reward);
                        claimBtn.disabled = true;
                        claimBtn.textContent = 'Claimed';
                    });
                }
                
                tasksContainer.appendChild(taskElement);
            });
        }

        // Claim Task Reward
        async function claimTaskReward(taskId, reward) {
            userData.balance += reward;
            userData.totalEarned += reward;
            
            // Mark task as completed
            if (!userData.tasksCompleted) {
                userData.tasksCompleted = {};
            }
            if (!userData.tasksCompleted[taskId]) {
                userData.tasksCompleted[taskId] = 0;
            }
            userData.tasksCompleted[taskId] += 1;
            
            updateUserUI();
            
            // Save to Firebase
            try {
                await db.collection('users').doc(currentUser.uid).update({
                    balance: userData.balance,
                    totalEarned: userData.totalEarned,
                    tasksCompleted: userData.tasksCompleted
                });
            } catch (error) {
                console.error("Error updating user data:", error);
                // Fallback to localStorage
                localStorage.setItem(`user_${currentUser.uid}`, JSON.stringify(userData));
            }
            
            alert(`Congratulations! You've claimed ${reward} SHIB.`);
        }

        // Load Admin Tasks
        function loadAdminTasks() {
            adminTasksContainer.innerHTML = '';
            
            if (!systemSettings.tasks || systemSettings.tasks.length === 0) {
                adminTasksContainer.innerHTML = '<div class="no-history">No tasks created yet.</div>';
                return;
            }
            
            systemSettings.tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = 'task-card';
                taskElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: bold;">${task.title}</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">Reward: ${task.reward} SHIB â€¢ Type: ${task.type}</div>
                        </div>
                        <div>
                            <button class="admin-button" onclick="editTask('${task.id}')">Edit</button>
                            <button class="admin-button reject" onclick="deleteTask('${task.id}')">Delete</button>
                        </div>
                    </div>
                `;
                adminTasksContainer.appendChild(taskElement);
            });
        }

        // Load Withdrawal History
        async function loadWithdrawalHistory() {
            try {
                const withdrawalsSnapshot = await db.collection('withdrawals')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const withdrawals = [];
                withdrawalsSnapshot.forEach(doc => {
                    const data = doc.data();
                    withdrawals.push({
                        id: doc.id,
                        ...data,
                        date: data.createdAt ? data.createdAt.toDate().toLocaleDateString() : 'Unknown'
                    });
                });
                
                if (withdrawals.length === 0) {
                    withdrawalHistoryContainer.innerHTML = '<div class="no-history">No withdrawal history yet.</div>';
                } else {
                    let tableHTML = '<table style="width: 100%; border-collapse: collapse;">';
                    tableHTML += '<tr><th>Date</th><th>Amount</th><th>Address</th><th>Status</th></tr>';
                    
                    withdrawals.forEach(withdrawal => {
                        tableHTML += `
                            <tr>
                                <td>${withdrawal.date}</td>
                                <td>${withdrawal.amount} SHIB</td>
                                <td>${withdrawal.address.substring(0, 10)}...${withdrawal.address.substring(withdrawal.address.length - 6)}</td>
                                <td>${withdrawal.status}</td>
                            </tr>
                        `;
                    });
                    
                    tableHTML += '</table>';
                    withdrawalHistoryContainer.innerHTML = tableHTML;
                }
            } catch (error) {
                console.error("Error loading withdrawal history:", error);
                withdrawalHistoryContainer.innerHTML = '<div class="no-history">No withdrawal history yet.</div>';
            }
        }

        // Load Pending Withdrawals for Admin
        async function loadPendingWithdrawals() {
            try {
                const pendingWithdrawalsSnapshot = await db.collection('withdrawals')
                    .where('status', '==', 'pending')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const pendingWithdrawals = [];
                pendingWithdrawalsSnapshot.forEach(doc => {
                    const data = doc.data();
                    pendingWithdrawals.push({
                        id: doc.id,
                        ...data,
                        date: data.createdAt ? data.createdAt.toDate().toLocaleDateString() : 'Unknown'
                    });
                });
                
                if (pendingWithdrawals.length === 0) {
                    pendingWithdrawalsContainer.innerHTML = '<div class="no-history">No pending withdrawals.</div>';
                    document.getElementById('pending-withdrawals').textContent = '0';
                } else {
                    document.getElementById('pending-withdrawals').textContent = pendingWithdrawals.length;
                    
                    let tableHTML = '<table class="admin-table">';
                    tableHTML += '<tr><th>User</th><th>Amount</th><th>Address</th><th>Date</th><th>Action</th></tr>';
                    
                    for (const withdrawal of pendingWithdrawals) {
                        // Get user data
                        const userDoc = await db.collection('users').doc(withdrawal.userId).get();
                        const userData = userDoc.exists ? userDoc.data() : { displayName: 'Unknown User' };
                        
                        tableHTML += `
                            <tr>
                                <td>${userData.displayName || 'Unknown User'}</td>
                                <td>${withdrawal.amount} SHIB</td>
                                <td>${withdrawal.address.substring(0, 10)}...${withdrawal.address.substring(withdrawal.address.length - 6)}</td>
                                <td>${withdrawal.date}</td>
                                <td>
                                    <button class="admin-button approve" onclick="approveWithdrawal('${withdrawal.id}')">Approve</button>
                                    <button class="admin-button reject" onclick="rejectWithdrawal('${withdrawal.id}')">Reject</button>
                                </td>
                            </tr>
                        `;
                    }
                    
                    tableHTML += '</table>';
                    pendingWithdrawalsContainer.innerHTML = tableHTML;
                }
            } catch (error) {
                console.error("Error loading pending withdrawals:", error);
                pendingWithdrawalsContainer.innerHTML = '<div class="no-history">No pending withdrawals.</div>';
                document.getElementById('pending-withdrawals').textContent = '0';
            }
        }

        // Load Admin Withdrawal History
        async function loadAdminWithdrawalHistory() {
            try {
                const withdrawalsSnapshot = await db.collection('withdrawals')
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .get();
                
                const withdrawals = [];
                withdrawalsSnapshot.forEach(doc => {
                    const data = doc.data();
                    withdrawals.push({
                        id: doc.id,
                        ...data,
                        date: data.createdAt ? data.createdAt.toDate().toLocaleDateString() : 'Unknown'
                    });
                });
                
                if (withdrawals.length === 0) {
                    adminWithdrawalHistoryContainer.innerHTML = '<div class="no-history">No withdrawal history.</div>';
                } else {
                    let tableHTML = '<table class="admin-table">';
                    tableHTML += '<tr><th>User</th><th>Amount</th><th>Address</th><th>Status</th><th>Date</th></tr>';
                    
                    for (const withdrawal of withdrawals) {
                        // Get user data
                        const userDoc = await db.collection('users').doc(withdrawal.userId).get();
                        const userData = userDoc.exists ? userDoc.data() : { displayName: 'Unknown User' };
                        
                        tableHTML += `
                            <tr>
                                <td>${userData.displayName || 'Unknown User'}</td>
                                <td>${withdrawal.amount} SHIB</td>
                                <td>${withdrawal.address.substring(0, 10)}...${withdrawal.address.substring(withdrawal.address.length - 6)}</td>
                                <td>${withdrawal.status}</td>
                                <td>${withdrawal.date}</td>
                            </tr>
                        `;
                    }
                    
                    tableHTML += '</table>';
                    adminWithdrawalHistoryContainer.innerHTML = tableHTML;
                }
            } catch (error) {
                console.error("Error loading admin withdrawal history:", error);
                adminWithdrawalHistoryContainer.innerHTML = '<div class="no-history">No withdrawal history.</div>';
            }
        }

        // Load Leaderboard with Real Data
        async function loadLeaderboard() {
            try {
                const usersSnapshot = await db.collection('users')
                    .where('referralCount', '>', 0)
                    .orderBy('referralCount', 'desc')
                    .limit(10)
                    .get();
                
                const users = [];
                usersSnapshot.forEach(doc => {
                    const data = doc.data();
                    users.push({
                        id: doc.id,
                        ...data
                    });
                });
                
                leaderboardContainer.innerHTML = '';
                
                if (users.length === 0) {
                    leaderboardContainer.innerHTML = '<div class="no-history">No users on leaderboard yet. Be the first!</div>';
                } else {
                    users.forEach((user, index) => {
                        const userElement = document.createElement('div');
                        userElement.className = 'leaderboard-item';
                        userElement.innerHTML = `
                            <div class="rank">${index + 1}</div>
                            <div class="user-avatar">${user.displayName ? user.displayName.charAt(0).toUpperCase() : 'U'}</div>
                            <div class="user-details">
                                <div class="user-name">${user.displayName || 'User'}</div>
                                <div class="user-id">ID: ${user.uid.substring(0, 8)}...</div>
                            </div>
                            <div class="referral-stats">
                                <div class="referral-count">${user.referralCount} Referrals</div>
                                <div class="referral-reward">${user.referralCount * systemSettings.referralReward} Reward</div>
                            </div>
                        `;
                        leaderboardContainer.appendChild(userElement);
                    });
                }
            } catch (error) {
                console.error("Error loading leaderboard:", error);
                leaderboardContainer.innerHTML = '<div class="no-history">No users on leaderboard yet. Be the first!</div>';
            }
        }

        // Load Admin Stats
        async function loadAdminStats() {
            try {
                // Count users
                const usersSnapshot = await db.collection('users').get();
                document.getElementById('total-users').textContent = usersSnapshot.size;
                
                // Count pending withdrawals
                const pendingWithdrawalsSnapshot = await db.collection('withdrawals')
                    .where('status', '==', 'pending')
                    .get();
                document.getElementById('pending-withdrawals').textContent = pendingWithdrawalsSnapshot.size;
                
                // Calculate ads statistics
                let totalAdsWatched = 0;
                let usersWithAdsLeft = 0;
                let totalAdRewards = 0;
                
                usersSnapshot.forEach(doc => {
                    const userData = doc.data();
                    totalAdsWatched += userData.adsWatched || 0;
                    totalAdRewards += userData.totalEarned || 0;
                    
                    if ((userData.adsToday || 0) < systemSettings.dailyAdLimit) {
                        usersWithAdsLeft++;
                    }
                });
                
                document.getElementById('total-ads-watched').textContent = totalAdsWatched;
                document.getElementById('users-with-ads-left').textContent = usersWithAdsLeft;
                document.getElementById('total-ad-rewards').textContent = totalAdRewards;
                
                document.getElementById('daily-ad-limit').textContent = systemSettings.dailyAdLimit;
            } catch (error) {
                console.error("Error loading admin stats:", error);
                document.getElementById('total-users').textContent = '0';
                document.getElementById('pending-withdrawals').textContent = '0';
                document.getElementById('daily-ad-limit').textContent = systemSettings.dailyAdLimit;
            }
        }

        // Watch Ad Button
        watchAdButton.addEventListener('click', () => {
            // Check if user has ads left for today
            if (userData.adsToday >= systemSettings.dailyAdLimit) {
                alert("You've reached your daily limit. Come back tomorrow!");
                return;
            }
            
            // Show loading indicator
            adLoading.classList.add('active');
            
            // Use the ad SDK to show the interstitial
            try {
                // In-App Interstitial - Fullscreen
                show_10005454({ 
                    type: 'inApp', 
                    inAppSettings: { 
                        frequency: 2, 
                        capping: 0.1, 
                        interval: 30, 
                        timeout: 5, 
                        everyPage: false 
                    } 
                });
                
                // Hide loading indicator after 2 seconds (assuming ad is loaded)
                setTimeout(() => {
                    adLoading.classList.remove('active');
                }, 2000);
                
                // Reward user after ad completion (simulated with timeout)
                setTimeout(() => {
                    rewardUser(systemSettings.rewardPerAd);
                    alert(`Congratulations! You've earned ${systemSettings.rewardPerAd} SHIB.`);
                }, 15000); // 15 seconds to simulate ad completion
                
            } catch (e) {
                console.log("Ad SDK error:", e);
                // Fallback: If the ad fails, simulate the ad
                adLoading.classList.remove('active');
                
                // Simulate ad with a simple modal
                const adSimulation = document.createElement('div');
                adSimulation.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: #000;
                    color: white;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                `;
                adSimulation.innerHTML = `
                    <h2 style="margin-bottom: 20px; color: var(--highlight);">Advertisement</h2>
                    <p style="margin-bottom: 30px;">This is a simulated ad</p>
                    <div class="spinner"></div>
                    <p style="margin-top: 20px;">Ad will complete in 10 seconds</p>
                    <button id="close-ad" style="margin-top: 30px; padding: 10px 20px; background: var(--highlight); color: white; border: none; border-radius: 5px; cursor: pointer;">Skip Ad</button>
                `;
                document.body.appendChild(adSimulation);
                
                let timeLeft = 10;
                const timer = setInterval(() => {
                    timeLeft--;
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        document.body.removeChild(adSimulation);
                        rewardUser(systemSettings.rewardPerAd);
                        alert(`Congratulations! You've earned ${systemSettings.rewardPerAd} SHIB.`);
                    }
                }, 1000);
                
                // Add event listener to skip button
                document.getElementById('close-ad').addEventListener('click', () => {
                    clearInterval(timer);
                    document.body.removeChild(adSimulation);
                    rewardUser(systemSettings.rewardPerAd);
                    alert(`Congratulations! You've earned ${systemSettings.rewardPerAd} SHIB.`);
                });
            }
        });

        // Reward User
        async function rewardUser(amount) {
            userData.balance += amount;
            userData.totalEarned += amount;
            userData.adsWatched++;
            userData.adsToday++;
            updateUserUI();
            
            // Save to Firebase
            try {
                await db.collection('users').doc(currentUser.uid).update({
                    balance: userData.balance,
                    totalEarned: userData.totalEarned,
                    adsWatched: userData.adsWatched,
                    adsToday: userData.adsToday
                });
            } catch (error) {
                console.error("Error updating user data:", error);
                // Fallback to localStorage
                localStorage.setItem(`user_${currentUser.uid}`, JSON.stringify(userData));
            }
        }

        // Withdraw SHIB
        async function withdrawButtonClick() {
            const amount = parseInt(document.getElementById('withdraw-amount').value);
            const address = document.getElementById('withdraw-address').value;
            
            if (!amount || !address) {
                alert('Please enter both amount and address');
                return;
            }
            
            if (amount < systemSettings.minWithdrawal) {
                alert(`You do not have enough SHIB to withdraw. Minimum withdrawal is ${systemSettings.minWithdrawal} SHIB.`);
                return;
            }
            
            if (amount > userData.balance) {
                alert('You do not have enough SHIB to withdraw.');
                return;
            }
            
            // Create withdrawal request in Firebase
            try {
                await db.collection('withdrawals').add({
                    userId: currentUser.uid,
                    amount: amount,
                    address: address,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update user balance
                userData.balance -= amount;
                await db.collection('users').doc(currentUser.uid).update({
                    balance: userData.balance
                });
                
                updateUserUI();
                
                alert(`Withdrawal request for ${amount} SHIB to ${address} has been submitted. It will be processed within 24 hours.`);
                
                // Clear form
                document.getElementById('withdraw-amount').value = '';
                document.getElementById('withdraw-address').value = '';
                
                // Reload withdrawal history
                loadWithdrawalHistory();
            } catch (error) {
                console.error("Error creating withdrawal:", error);
                alert('Error processing withdrawal. Please try again.');
            }
        }

        // Add Task Form
        addTaskForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const title = document.getElementById('task-title').value;
            const description = document.getElementById('task-description').value;
            const reward = parseInt(document.getElementById('task-reward').value);
            const type = document.getElementById('task-type').value;
            const total = parseInt(document.getElementById('task-total').value);
            
            // Create new task
            const newTask = {
                id: 'task_' + Date.now(),
                title: title,
                description: description,
                reward: reward,
                type: type,
                total: total
            };
            
            // Add to system settings
            if (!systemSettings.tasks) {
                systemSettings.tasks = [];
            }
            systemSettings.tasks.push(newTask);
            
            // Save to Firebase
            await saveSystemSettings();
            
            alert(`Task "${title}" added successfully!`);
            
            // Reset form
            addTaskForm.reset();
            
            // Reload tasks
            loadAdminTasks();
            // Tasks will automatically update in user panel via real-time listener
        });

        // System Settings Form
        systemSettingsForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            systemSettings.rewardPerAd = parseInt(document.getElementById('reward-per-ad').value);
            systemSettings.dailyAdLimit = parseInt(document.getElementById('daily-ad-limit').value);
            systemSettings.minWithdrawal = parseInt(document.getElementById('min-withdrawal').value);
            systemSettings.referralReward = parseInt(document.getElementById('referral-reward').value);
            
            // Save to Firebase
            await saveSystemSettings();
            
            alert('System settings updated successfully!');
            
            // Update UI
            updateSystemSettingsUI();
        });

        // Save System Settings to Firebase
        async function saveSystemSettings() {
            try {
                await db.collection('systemSettings').doc('settings').set(systemSettings);
            } catch (error) {
                console.error("Error saving system settings:", error);
                // Fallback to localStorage
                localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            }
        }

        // Restock Ads for All Users
        restockAllAdsBtn.addEventListener('click', async () => {
            if (confirm('Are you sure you want to restock ads for all users? This will reset their daily ad count.')) {
                try {
                    const usersSnapshot = await db.collection('users').get();
                    const today = new Date().toDateString();
                    
                    // Use batched writes to update all users
                    const batch = db.batch();
                    usersSnapshot.forEach(doc => {
                        batch.update(doc.ref, {
                            adsToday: 0,
                            lastAdReset: today
                        });
                    });
                    
                    await batch.commit();
                    alert('Ads restocked for all users successfully!');
                    
                    // Also update current user data if they're logged in
                    if (userData) {
                        userData.adsToday = 0;
                        userData.lastAdReset = today;
                        updateUserUI();
                        
                        // Update in Firebase
                        await db.collection('users').doc(currentUser.uid).update({
                            adsToday: 0,
                            lastAdReset: today
                        });
                    }
                } catch (error) {
                    console.error("Error restocking ads:", error);
                    alert('Error restocking ads. Please try again. Error: ' + error.message);
                }
            }
        });

        // Navigation
        const navItems = document.querySelectorAll('.nav-item');
        const sections = document.querySelectorAll('.section');
        
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all nav items and sections
                navItems.forEach(nav => nav.classList.remove('active'));
                sections.forEach(section => section.classList.remove('active'));
                
                // Add active class to clicked nav item
                this.classList.add('active');
                
                // Show corresponding section
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
            });
        });

        // Copy Referral Link
        const copyButton = document.querySelector('.copy-button');
        const referralLink = document.querySelector('.referral-link');
        
        copyButton.addEventListener('click', function() {
            const textArea = document.createElement('textarea');
            textArea.value = referralLink.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            // Visual feedback
            const originalText = copyButton.textContent;
            copyButton.textContent = 'Copied!';
            copyButton.style.background = 'linear-gradient(135deg, var(--success), #6fcf97)';
            
            setTimeout(() => {
                copyButton.textContent = originalText;
                copyButton.style.background = 'linear-gradient(135deg, var(--accent), var(--highlight))';
            }, 2000);
        });

        // Admin Functions
        async function editTask(taskId) {
            const task = systemSettings.tasks.find(t => t.id === taskId);
            if (task) {
                document.getElementById('task-title').value = task.title;
                document.getElementById('task-description').value = task.description;
                document.getElementById('task-reward').value = task.reward;
                document.getElementById('task-type').value = task.type;
                document.getElementById('task-total').value = task.total;
                
                // Remove the task
                deleteTask(taskId);
            }
        }

        async function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                systemSettings.tasks = systemSettings.tasks.filter(t => t.id !== taskId);
                await saveSystemSettings();
                loadAdminTasks();
                // Tasks will automatically update in user panel via real-time listener
                alert('Task deleted successfully!');
            }
        }

        async function approveWithdrawal(withdrawalId) {
            if (confirm('Approve this withdrawal?')) {
                try {
                    await db.collection('withdrawals').doc(withdrawalId).update({
                        status: 'approved',
                        processedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    alert('Withdrawal approved successfully!');
                    loadPendingWithdrawals();
                    loadAdminWithdrawalHistory();
                } catch (error) {
                    console.error("Error approving withdrawal:", error);
                    alert('Error approving withdrawal. Please try again.');
                }
            }
        }

        async function rejectWithdrawal(withdrawalId) {
            if (confirm('Reject this withdrawal?')) {
                try {
                    // Get withdrawal details to refund user
                    const withdrawalDoc = await db.collection('withdrawals').doc(withdrawalId).get();
                    const withdrawalData = withdrawalDoc.data();
                    
                    // Refund user
                    const userDoc = await db.collection('users').doc(withdrawalData.userId).get();
                    const userData = userDoc.data();
                    
                    await db.collection('users').doc(withdrawalData.userId).update({
                        balance: userData.balance + withdrawalData.amount
                    });
                    
                    // Update withdrawal status
                    await db.collection('withdrawals').doc(withdrawalId).update({
                        status: 'rejected',
                        processedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    alert('Withdrawal rejected and user refunded!');
                    loadPendingWithdrawals();
                    loadAdminWithdrawalHistory();
                } catch (error) {
                    console.error("Error rejecting withdrawal:", error);
                    alert('Error rejecting withdrawal. Please try again.');
                }
            }
        }

        // Event Listeners
        withdrawButton.addEventListener('click', withdrawButtonClick);

        // Initialize the app
        initializeApp();
    </script>
</body>
</html>
